<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyClaw - å…³é”®é…ç½®ç®¡ç†ï¼ˆå¢å¼ºç‰ˆï¼‰</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f7fa; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 20px; border-radius: 12px; margin-bottom: 30px; }
        header h1 { font-size: 2rem; margin-bottom: 10px; }
        .card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .card h2 { color: #667eea; margin-bottom: 20px; font-size: 1.3rem; }
        .btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-danger { background: #e74c3c; }
        .btn-success { background: #2ecc71; }
        .login-container { max-width: 400px; margin: 60px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .login-container h1 { text-align: center; color: #667eea; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .hidden { display: none; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 16px 24px; border-radius: 8px; color: white; font-weight: 500; box-shadow: 0 4px 20px rgba(0,0,0,0.2); z-index: 1000; opacity: 0; transform: translateY(-20px); transition: all 0.3s; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast-success { background: #2ecc71; }
        .toast-error { background: #e74c3c; }
        .toast-info { background: #667eea; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .status-item { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
        .status-item .label { color: #666; font-size: 0.9rem; margin-bottom: 8px; }
        .status-item .value { font-size: 1.8rem; font-weight: bold; color: #667eea; }
        @media (max-width: 768px) {
            header h1 { font-size: 1.5rem; }
            .status-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="toast" class="toast"></div>
    
    <div class="container">
        <!-- ç™»å½•é¡µé¢ -->
        <div id="loginPage" class="login-container">
            <h1>ğŸ” EasyClaw</h1>
            <div class="form-group">
                <label for="tokenInput">è¯·è¾“å…¥ OpenClaw Gateway Token</label>
                <input type="password" id="tokenInput" placeholder="ç²˜è´´ä½ çš„ token" onkeypress="if(event.key==='Enter')login()">
            </div>
            <button class="btn" style="width:100%" onclick="login()">ç™»å½•</button>
        </div>
        
        <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
        <div id="dashboardPage" class="hidden">
            <header>
                <h1>ğŸ›ï¸ EasyClaw å…³é”®é…ç½®ç®¡ç†ï¼ˆå¢å¼ºç‰ˆï¼‰</h1>
                <p>æœç´¢æœåŠ¡å¢å¼ºã€èµ„æºåº“åˆ é™¤ã€è‡ªåŠ¨å¤‡ä»½</p>
            </header>
            
            <!-- çŠ¶æ€æ¦‚è§ˆ -->
            <div class="card">
                <h2>ğŸ“Š çŠ¶æ€æ¦‚è§ˆ</h2>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="label">é»˜è®¤æ¨¡å‹</div>
                        <div class="value" id="defaultModel">-</div>
                    </div>
                    <div class="status-item">
                        <div class="label">å¤‡é€‰é“¾é•¿åº¦</div>
                        <div class="value" id="fallbackCount">-</div>
                    </div>
                    <div class="status-item">
                        <div class="label">å·²æ¿€æ´»æ¨¡å‹</div>
                        <div class="value" id="modelCount">-</div>
                    </div>
                    <div class="status-item">
                        <div class="label">å­ Agent</div>
                        <div class="value" id="subagentStatus">-</div>
                    </div>
                </div>
            </div>
            
            <!-- è¯´æ˜ï¼šåç«¯ API å·²å¢å¼ºï¼Œå‰ç«¯ç•Œé¢åç»­ä¼˜åŒ– -->
            <div class="card">
                <h2>ğŸ“‹ è¯´æ˜</h2>
                <p>åç«¯ API å·²å¢å¼ºï¼š</p>
                <ul>
                    <li>æœç´¢æœåŠ¡ç®¡ç† APIï¼ˆå®˜æ–¹+ç¬¬ä¸‰æ–¹ï¼Œ3ä¸ªå®˜æ–¹æœç´¢æœåŠ¡ï¼‰</li>
                    <li>èµ„æºåº“åˆ é™¤ APIï¼ˆå¸¦äºŒæ¬¡ç¡®è®¤å’Œå¤‡ä»½ï¼‰</li>
                    <li>æ‰€æœ‰ä¿®æ”¹æ“ä½œå‰è‡ªåŠ¨å¤‡ä»½</li>
                </ul>
                <p>å‰ç«¯ç•Œé¢åç»­ä¼˜åŒ–ä¸­...</p>
            </div>
        </div>
    </div>
    
    <script>
        let isLoggedIn = false;
        
        // Toast æç¤º
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast toast-' + type;
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // ç™»å½•
        async function login() {
            const token = document.getElementById('tokenInput').value;
            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token })
                });
                if (res.ok) {
                    isLoggedIn = true;
                    showDashboard();
                    loadData();
                    showToast('ç™»å½•æˆåŠŸï¼', 'success');
                } else {
                    showToast('Token æ— æ•ˆï¼Œè¯·é‡è¯•', 'error');
                }
            } catch (e) {
                showToast('ç™»å½•å¤±è´¥: ' + e.message, 'error');
            }
        }
        
        // æ˜¾ç¤ºä»ªè¡¨ç›˜
        function showDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // åŠ è½½è·¯ç”±é…ç½®
                const routingRes = await fetch('/api/routing');
                if (routingRes.ok) {
                    const data = await routingRes.json();
                    document.getElementById('defaultModel').textContent = data.defaultModel || '-';
                    document.getElementById('fallbackCount').textContent = (data.fallbacks || []).length;
                }
                
                // åŠ è½½æ¨¡å‹åˆ—è¡¨
                const modelsRes = await fetch('/api/inventory/models');
                if (modelsRes.ok) {
                    const data = await modelsRes.json();
                    document.getElementById('modelCount').textContent = (data.models || []).length;
                }
                
                // åŠ è½½å­ Agent çŠ¶æ€
                const subagentRes = await fetch('/api/routing');
                if (subagentRes.ok) {
                    const data = await subagentRes.json();
                    const enabled = data.subagent && data.subagent.enabled;
                    document.getElementById('subagentStatus').textContent = 
                        enabled ? 'âœ… å¼€å¯' : 'âŒ å…³é—­';
                }
            } catch (e) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥', e);
            }
        }
    </script>
</body>
</html>
